<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Geonovum">
        <link rel="canonical" href="https://apitestdocs.geonovum.nl/setup/geoserver/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Setup GeoServer - Geonovum OGC API Testbed</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Geonovum OGC API Testbed</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../howto/" class="nav-link">Howto</a>
                            </li>
                            <li class="navitem">
                                <a href="../" class="nav-link">Setup</a>
                            </li>
                            <li class="navitem">
                                <a href="../../findings/" class="nav-link">Results</a>
                            </li>
                            <li class="navitem">
                                <a href="https://github.com/Geonovum/ogc-api-testbed" class="nav-link">Code</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/Geonovum/ogc-api-testbed/edit/master/docs/setup/geoserver.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#setup-geoserver" class="nav-link">Setup GeoServer</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#ogc-api-community-module" class="nav-link">OGC API Community module</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#scripted-configuration-vs-dynamic-configuration" class="nav-link">Scripted configuration vs dynamic configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#geoserver-behind-a-gateway-traefik" class="nav-link">GeoServer behind a gateway (traefik)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#geoserver-and-docker" class="nav-link">GeoServer and docker</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#issues" class="nav-link">Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#open-research-questions" class="nav-link">Open research questions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="setup-geoserver">Setup GeoServer</h1>
<p>A docker hub image is provided by <a href="https://github.com/oscarfonts/docker-geoserver">oscarfonts</a> is extended with OGC API plugin. The binaries of the plugin, as well as the data folder are mounted into the container. The <code>Oscar Fonts</code> image runs as a tomcat user, which by itself is a good practice from security prespective, but files are created on the data folder by a user unknown to the docker host, which causes problems at redeployment. We have overridden this behaviour and run as root user.</p>
<p>The data folder is created by deploying geoserver locally, setting up the required services and commit the changes to github. You can either embed a data file inside the data folder, alternatively you can upload data to the PostGreSQL database and configure a layer on data from the database.</p>
<p>The OGC API is available from the geoserver homepage at /ogc/features, or on the workspace endpoint /{workspace}/agc/features.</p>
<h2 id="ogc-api-community-module">OGC API Community module</h2>
<p>The GeoServer community has been involved in the OGC sprints while the standards were shaped to its current form. The implementation of OGC API currently has the form of a <a href="https://docs.geoserver.org/latest/en/user/community/ogc-api/index.html">community plugin</a>, which can be installed on recent versions of GeoServer.</p>
<h2 id="scripted-configuration-vs-dynamic-configuration">Scripted configuration vs dynamic configuration</h2>
<p>GeoServer has an extended web user interface as well as a rest api to configure the publication of datasets. These configurations are persisted as xml files in the config folder. Alternatively you can use a scripted approach to configure the server, the xml files in the conig folder are deployed as part of the deployment. Both approaches can however not easily be combined. It means you have to decide for a server if you set it up scripted or dynamically. The scripted approach is mostly used in advanced setups such as App Schema INSPIRE.</p>
<p>Most challenging is a sequential update number which is updated with every dynamic update of the configuration via the api.</p>
<p>The configuration with xml files is also a challenge when scaling out and load balancing GeoServer. When these files are updated by one instance, the other instances need to be synchronised. Some community plugins are available, such as jdbc-config, which enables the storage of configuration in a central database. </p>
<h2 id="geoserver-behind-a-gateway-traefik">GeoServer behind a gateway (traefik)</h2>
<p>Running GeoServer behind a gateway, which exposes geoserver at an alternative domain, requires a proxy url to be configured on GeoServer. You need to manage this in an xml file, because the admin interface (which offers an option to configure this also) doesn't work correctly if the proxy url is not correctly set up.</p>
<p>Recent versions of GeoServer have added a CSRF protection against script attacks. This CSRF leads to unexpected results when running GeoServer via a gateway. The gateway domain needs to be whitelisted or CSRF vealidation deactivated. Read more at https://docs.geoserver.org/stable/en/user/security/webadmin/csrf.html</p>
<h2 id="geoserver-and-docker">GeoServer and docker</h2>
<p>The installation of GeoServer requires to add the OGC API plugin (check a matching version number). It is quite common that GeoServer is extended with plugins. We used the docker image provided by <a href="https://github.com/oscarfonts/docker-geoserver">oscarfonts</a>, which has a nice mechanism to place plugins (and data folder) on a mounted volume.</p>
<p>In order to configure a new resource on GeoServer we added the required configuration files to the geonovum github repository. GeoServer also has a web interface and rest api to configure resources, but note that any resource added manually may be overwritten from github with the new deployment of the software.</p>
<p>An alternative for manual setup us the <a href="https://geocat.net/bridge">GeoCat bridge</a> tool, which is a typical tool to configure new resources on GeoServer from within the QGIS or ArcMAP Desktop application.</p>
<h2 id="issues">Issues</h2>
<p>Some issues found during deployment (and solutions where found)</p>
<ul>
<li><a href="https://github.com/Geonovum/ogc-api-testbed/issues/22">Issue #22</a> - Permission Issue for mounted dirs: the GeoServer Container permanently changes the ownership of mounted dirs</li>
<li><a href="https://github.com/Geonovum/ogc-api-testbed/issues/21">Issue #21</a> - OGC API Plugin: running on subpath with https does not render linked resources correctly</li>
</ul>
<h2 id="open-research-questions">Open research questions</h2>
<ul>
<li>how are metadata links configured on layers, exposed in ogc api features</li>
<li>are there an options to fetch gml, app-schema gml and/or geopackage via ogc-api features</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>&copy; 2021 Geonovum</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
